<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Historial de Compras</title>
  <link rel="stylesheet" href="/styles.css" />
</head>

<body>
<h1>Historial de Compras</h1>

<a href="/carrito">Volver</a>
<hr>

<% if (historial.length === 0) { %>
  <p>No tienes compras registradas.</p>
<% } %>

<% historial.forEach(item => { %>

  <div style="border:1px solid #ccc; padding:10px; margin-bottom:20px;">
    <p><strong>Fecha:</strong> <%= item.compra.fecha.toLocaleString() %></p>
    <p><strong>Total:</strong> $<%= item.compra.total %></p>

    <table border="1" cellpadding="5" cellspacing="0">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Cantidad</th>
          <th>Precio Unit.</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        <% item.detalles.forEach(det => { %>
          <tr>
            <td><%= det.producto.nombre %></td>
            <td><%= det.cantidad %></td>
            <td>$<%= det.precio_unitario %></td>
            <td>$<%= det.subtotal %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

<% }) %>

</body>
</html>