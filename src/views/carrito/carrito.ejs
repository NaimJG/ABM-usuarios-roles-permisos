<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mi Carrito</title>
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/css/carrito.css" />
</head>

<body>
    <h1>Mi carrito</h1>

    <div class="carrito-container">
        <a href="/">← Volver al catálogo</a>

        <hr color="#A67C52"><br>

        <% if (carrito.items.length === 0) { %>
            <p>Tu carrito está vacío.</p>
        <% } %>

        <a href="/compras/historial">Ver mi historial de compras</a>

        <% carrito.items.forEach(item => { %>
            <div class="producto">
                <h3><%= item.producto.nombre %></h3>
                <% if (item.producto.imagen) { %>
                    <img src="<%= item.producto.imagen %>" alt="<%= item.producto.nombre %>" class="img-producto">
                <% } %>
                <p>Precio: $<%= item.producto.precio %></p>

                <form action="/carrito/actualizar/<%= item.id %>" method="POST">
                    <label>Cantidad:</label>
                    <input 
                        type="number" 
                        name="cantidad" 
                        value="<%= item.cantidad %>"
                        min="1"
                        max="<%= item.producto.stock %>"
                    >
                    <button class="btn">Actualizar</button>
                </form>
                <% if (item.cantidad >= item.producto.stock) { %>
                    <p style="color:red; margin-top:5px;">
                        Alcanzaste el stock máximo disponible.
                    </p>
                <% } %>

                <form action="/carrito/eliminar/<%= item.id %>" method="POST">
                    <button class="btn btn-danger">Eliminar</button>
                </form>
            </div>
        <% }) %>

        <% if (carrito.items.length > 0) { %>
            <form action="/carrito/confirmar" method="POST">
                <button class="btn btn-confirmar">Confirmar compra</button>
            </form>
        <% } %>
    </div>

        <script>
            document.querySelectorAll("input[name='cantidad']").forEach(input => {
                input.addEventListener("input", () => {
                const max = parseInt(input.max);
                if (parseInt(input.value) > max) {
                    input.value = max;
                    showToast("No puedes superar el stock disponible");
                }
                });
            });
        </script>

</body>
</html>